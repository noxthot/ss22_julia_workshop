<!doctype html> <html lang=en > <script src="/ss22_julia_workshop/libs/clipboard.min.js"></script> <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/ss22_julia_workshop/libs/katex/katex.min.css"> <link rel=stylesheet  href="/ss22_julia_workshop/libs/highlight/github.min.css"> <link rel=stylesheet  href="/ss22_julia_workshop/css/jtd.css"> <link rel=stylesheet  href="/ss22_julia_workshop/css/extras.css"> <link rel=icon  href="/ss22_julia_workshop/assets/favicon.ico"> <style> /* #148 wrap long header */ .franklin-content a.header-anchor, .franklin-toc li a { word-wrap: break-word; white-space: normal; } </style> <title>Parallel computing with Julia</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/ss22_julia_workshop/" class=title > Julia </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/ss22_julia_workshop/" class="menu-list-link ">Start</a> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/" class="menu-list-link ">Introduction</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/basis_datatypes_and_operations" class=menu-list-link >Basic Datatypes and Operations</a> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/matrix_vectors" class=menu-list-link >Matrix and Vector Operations</a> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/loops" class=menu-list-link >Loops</a <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/worksheet_1" class=menu-list-link >Worksheet 1</a> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/introduction/worksheet_2" class=menu-list-link >Worksheet 2</a> </ul> <li class="menu-list-item active"><a href="/ss22_julia_workshop/pages/hpc/" class="menu-list-link active">Parallel computing</a> <li class="menu-list-item "><a href="/ss22_julia_workshop/pages/datascience/" class="menu-list-link ">Data Science</a> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > SS22 Julia Workshop Obergurgl </div> <div class=franklin-content ><h1 id=parallel_computing_with_julia ><a href="#parallel_computing_with_julia" class=header-anchor >Parallel computing with Julia</a></h1> <p>Since modern laptops and computers come with multiple cores parallel computing is not just something for High Performance Computing systems. The general idea is to not only use a single computational thread &#40;linear programming&#41; but run concurring tasks at the same time that solve the task you set them. Julia by default supports different ways for active <a href="https://docs.julialang.org/en/v1/manual/parallel-computing/">parallel or concurring computing</a>. In this section we follow some of the examples given on <a href="https://github.com/JuliaAcademy/JuliaTutorials">Julia Academy - JuliaTutorials</a>.</p> <p>Before we are are going into the details of parallel coding we need to talk about how to measure performance in Julia.</p> <h2 id=how_to_measure_performance_in_julia ><a href="#how_to_measure_performance_in_julia" class=header-anchor >How to measure performance in Julia</a></h2> <p>For that, we recall the loops example from the introduction to <a href="../../introduction/loops.html">loops</a> and include the simple <code>@time</code> macro.</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> mysum(a)
    result = zero(eltype(a))

    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> eachindex(a)
        <span class=hljs-meta >@inbounds</span> result += a[i]
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> result
<span class=hljs-keyword >end</span>

a = rand(<span class=hljs-number >100_000</span>)
<span class=hljs-meta >@time</span> mysum(a)
<span class=hljs-meta >@time</span> mysum(a)</code></pre> <pre><code class="plaintext hljs">  0.008262 seconds (4.16 k allocations: 222.597 KiB, 97.69% compilation time)
  0.000173 seconds (1 allocation: 16 bytes)
49930.26944385337</code></pre> <p>The downside with the <code>@time</code> macro is, that it really just measures the execution time of what is given to it. This means if the function is not already compiled this might include compiling or if the CPU is busy with something else it is often not accurate. </p> <p>Therefore, if you are serious about measuring performance you should stick to the <a href="https://juliaci.github.io/BenchmarkTools.jl/stable/"><code>BenchmarkTools</code></a>. It comes with a couple of macros that you should test out:</p> <button type=button  class=collapsible  style="background-color:#0089ff"> Exercise </button><div class=collapsiblecontent > In order to use the BenchmarkTools you need to include it with <code>using BenchmarkTools</code>, as any other package. Benchmark your <code>mysum</code> function with the following macros:</p> <ol> <li><p><code>@benchmark</code></p> <li><p><code>@btime</code> </p> <li><p>Look at the detailed output of your benchmark with <code>dump&#40;t&#41;</code>, where <code>t</code> is the output result of a <code>@benchmark</code> run.</p> </ol> <p>and compare the output and results. <div class=solution > Solution </div><div class=solution > To measure the performance of the above code we do the following:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> BenchmarkTools

<span class=hljs-meta >@benchmark</span> mysum($a)</code></pre> <p><pre><code class="plaintext hljs">BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range (min … max):  160.399 μs … 215.500 μs  ┊ GC (min … max): 0.00% … 0.00%
 Time  (median):     160.400 μs               ┊ GC (median):    0.00%
 Time  (mean ± σ):   160.816 μs ±   1.972 μs  ┊ GC (mean ± σ):  0.00% ± 0.00%

  █                                                             ▁
  █▇▆▄▃▄▁▁▁▁▆▇█▇▇▆▅▁▃▁▁▁▁▁▃▃▁▁▃▁▅▅▇▇▇▆▅▆▆▅▆▄▆▄▆▄▆▆▇▄▇▆▆▅▇▅▆▅▆▅▅ █
  160 μs        Histogram: log(frequency) by time        170 μs &lt;

 Memory estimate: 0 bytes, allocs estimate: 0.</code></pre> the full details with </p> <pre><code class="julia hljs">t = <span class=hljs-meta >@benchmark</span> mysum($a)
dump(t)</code></pre> <p><pre><code class="plaintext hljs">BenchmarkTools.Trial
  params: BenchmarkTools.Parameters
    seconds: Float64 5.0
    samples: Int64 10000
    evals: Int64 1
    overhead: Float64 0.0
    gctrial: Bool true
    gcsample: Bool false
    time_tolerance: Float64 0.05
    memory_tolerance: Float64 0.01
  times: Array{Float64}((10000,)) [167800.0, 160700.0, 160400.0, 163899.0, 160400.0, 160400.0, 160400.0, 160400.0, 160400.0, 160400.0  …  160400.0, 160400.0, 160400.0, 162600.0, 160500.0, 160400.0, 160400.0, 160400.0, 160399.0, 160400.0]
  gctimes: Array{Float64}((10000,)) [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
  memory: Int64 0
  allocs: Int64 0
</code></pre> and the often used sanity check, that actually also shows you the output of your code.</p> <pre><code class="julia hljs"><span class=hljs-meta >@btime</span> mysum($a)</code></pre>
<p><pre><code class="plaintext hljs">  160.399 μs (0 allocations: 0 bytes)
49930.26944385337</code></pre> </div> </div>
<p>We can also use the <a href="https://docs.julialang.org/en/v1/manual/profile/#Profiling"><code>Profiler</code></a> package to really dig into profiling the code but this is a bit too much of a deep dive for this class, it would look like this:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Profile

Profile.clear()
<span class=hljs-meta >@profile</span> <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >100_000</span>; mysum($a); <span class=hljs-keyword >end</span>
Profile.print(maxdepth=<span class=hljs-number >15</span>)</code></pre>
<pre><code class="bash hljs">Overhead ╎ [+additional indent] Count File:Line; Function
=========================================================
    ╎8281  @Base/client.jl:495; _start()
    ╎ 8281  @Base/client.jl:309; exec_options(opts::Base.JLOptions)
    ╎  8281  @Base/client.jl:379; run_main_repl(interactive::Bool, quiet::Bool, banner::Bool, history_file::Bool, color_set::Bool)
    ╎   8281  @Base/essentials.jl:714; invokelatest
    ╎    8281  @Base/essentials.jl:716; <span class=hljs-comment >#invokelatest#2</span>
    ╎     8281  @Base/client.jl:394; (::Base.var<span class=hljs-string >&quot;#936#938&quot;</span>{Bool, Bool, Bool})(REPL::Module)
    ╎    ╎ 8281  ...r/worker/package_linux64/build/usr/share/julia/stdlib/v1.7/REPL/src/REPL.jl:351; run_repl(repl::REPL.AbstractREPL, consumer::Any)
    ╎    ╎  8281  ...r/worker/package_linux64/build/usr/share/julia/stdlib/v1.7/REPL/src/REPL.jl:364; run_repl(repl::REPL.AbstractREPL, consumer::Any; backend_on_current_task::Bool)
    ╎    ╎   8281  .../worker/package_linux64/build/usr/share/julia/stdlib/v1.7/REPL/src/REPL.jl:231; start_repl_backend(backend::REPL.REPLBackend, consumer::Any)
    ╎    ╎    8281  .../worker/package_linux64/build/usr/share/julia/stdlib/v1.7/REPL/src/REPL.jl:246; repl_backend_loop(backend::REPL.REPLBackend)
    ╎    ╎     8281  ...worker/package_linux64/build/usr/share/julia/stdlib/v1.7/REPL/src/REPL.jl:150; eval_user_input(ast::Any, backend::REPL.REPLBackend)
    ╎    ╎    ╎ 8281  @Base/boot.jl:373; <span class=hljs-built_in >eval</span>
    ╎    ╎    ╎  8281  .../package_linux64/build/usr/share/julia/stdlib/v1.7/Profile/src/Profile.jl:28; top-level scope
   1╎    ╎    ╎   8281  REPL[18]:1; macro expansion
    ╎    ╎    ╎    1     REPL[7]:3; mysum(a::Vector{Float64})
    ╎    ╎    ╎     1     @Base/abstractarray.jl:279; eachindex
    ╎    ╎    ╎    8279  REPL[7]:4; mysum(a::Vector{Float64})
    ╎    ╎    ╎     8279  @Base/range.jl:837; iterate
Total snapshots: 16562</code></pre>
<h1 id=single-instruction_multiple_data ><a href="#single-instruction_multiple_data" class=header-anchor >Single-Instruction multiple data</a></h1>
<p>Before we are going to specifically parallelise code we talk about an inbuilt mechanism called Single-instruction, multiple data or <a href="https://docs.julialang.org/en/v1/base/simd-types/">SIMD</a> for short. The main idea is that CPUs &#40;or basically any ALU core&#41; can perform the same operation on multiple inputs in a single clock cycle. This was already used for BLAS and LAPACK packages, with the so call unlooping.</p>
<p>Let us consider the following example</p>
<div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.25em  columnalign=right  columnspacing=""><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><mo>→</mo><msub><mi>z</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>2</mn></msub><mo>→</mo><msub><mi>z</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>+</mo><msub><mi>y</mi><mn>3</mn></msub><mo>→</mo><msub><mi>z</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>x</mi><mn>4</mn></msub><mo>+</mo><msub><mi>y</mi><mn>4</mn></msub><mo>→</mo><msub><mi>z</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
x_1 + y_1 \to z_1\\
x_2 + y_2 \to z_2\\
x_3 + y_3 \to z_3\\
x_4 + y_4 \to z_4
\end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:6em;vertical-align:-2.75em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.25em;"><span style="top:-5.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>which should look pretty familiar from the basic vector addition <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mi>x</mi><mo>+</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">z = x + y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>. As mentioned, modern processors have <em>vector units</em> that can deal with this kind of operation at once, basically:</p>
<div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.25em  columnalign=right  columnspacing=""><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow><mo fence=true >(</mo><mtable rowspacing=0.16em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mn>3</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mn>4</mn></msub></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow><mo>+</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.16em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mn>3</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mn>4</mn></msub></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow><mo>→</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.16em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>z</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>z</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>z</mi><mn>3</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>z</mi><mn>4</mn></msub></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\begin{pmatrix}
x_1\\
x_2\\
x_3\\
x_4
\end{pmatrix}
+
\begin{pmatrix}
y_1\\
y_2\\
y_3\\
y_4
\end{pmatrix}
\to
\begin{pmatrix}
z_1\\
z_2\\
z_3\\
z_4
\end{pmatrix}
\end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:5.1001em;vertical-align:-2.3em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.8em;"><span style="top:-4.8em;"><span class=pstrut  style="height:4.65em;"></span><span class=mord ><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V1216 H291z M291 0 H417 V1216 H291z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-4.81em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V1216 H457z M457 0 H583 V1216 H457z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V1216 H291z M291 0 H417 V1216 H291z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-4.81em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V1216 H457z M457 0 H583 V1216 H457z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V1216 H291z M291 0 H417 V1216 H291z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-4.81em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='1.216em' style='width:0.875em' viewBox='0 0 875 1216' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V1216 H457z M457 0 H583 V1216 H457z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.3em;"><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>This looks otley familiar, as this is our sum example. We can modify our sum over a vector, and learn how Julia is including the SIMD concept and why it is most of the time better to call library functions than programming them on your own. As we know how to do benchmarking lets try to figure out if our sum function is doing a good job.</p>
<pre><code class="julia hljs">println(<span class=hljs-string >&quot;\nSimple sum:&quot;</span>)
<span class=hljs-meta >@btime</span> mysum($a)
println(<span class=hljs-string >&quot;\nBuilt-in sum:&quot;</span>)
<span class=hljs-meta >@btime</span> sum($a)</code></pre>
<p><pre><code class="plaintext hljs">
Simple sum:
  160.399 μs (0 allocations: 0 bytes)

Built-in sum:
  12.700 μs (0 allocations: 0 bytes)
49930.269443853176</code></pre> As we can see, we are slower, exactly how much slower depends on the architecture of your CPU but it is usually between 2 to 16 times. </p>
<p>In order to enable simd in a program &#40;if it is not done by library calls anyway&#41; you can use the <code>@simd</code> macro, this works if you loop over the indices or the elements, Julia is quite flexible there. </p>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> mysimdsum(a)
    result = zero(eltype(a))

    <span class=hljs-meta >@simd</span> <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> eachindex(a)
        <span class=hljs-meta >@inbounds</span> result += a[i]
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> result
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> mysum2(V)
    s = zero(eltype(V))

    <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> V
        s += v
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> s
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> mysimdsum2(V)
    s = zero(eltype(V))

    <span class=hljs-meta >@simd</span> <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> V
        s += v
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> s
<span class=hljs-keyword >end</span>

println(<span class=hljs-string >&quot;\nSimple mysum(a) = &quot;</span>, mysum(a))
<span class=hljs-meta >@btime</span> mysum($a)
println(<span class=hljs-string >&quot;\nBuilt-in sum(a) = &quot;</span>, sum(a))
<span class=hljs-meta >@btime</span> sum($a)
println(<span class=hljs-string >&quot;\nSimple mysimdsum = &quot;</span>, mysimdsum(a))
<span class=hljs-meta >@btime</span> mysimdsum($a)
println(<span class=hljs-string >&quot;\nSimple mysum2 = &quot;</span>, mysum2(a))
<span class=hljs-meta >@btime</span> mysum2($a)
println(<span class=hljs-string >&quot;\nSimple mysimdsum2 = &quot;</span>, mysimdsum2(a))
<span class=hljs-meta >@btime</span> mysimdsum2($a)</code></pre>
<p><pre><code class="plaintext hljs">
Simple mysum(a) = 49930.26944385337
  160.399 μs (0 allocations: 0 bytes)

Built-in sum(a) = 49930.269443853176
  12.700 μs (0 allocations: 0 bytes)

Simple mysimdsum = 49930.26944385315
  10.100 μs (0 allocations: 0 bytes)

Simple mysum2 = 49930.26944385337
  160.399 μs (0 allocations: 0 bytes)

Simple mysimdsum2 = 49930.26944385315
  10.199 μs (0 allocations: 0 bytes)
49930.26944385315</code></pre> We can see a massive speed up &#40;that will depend on the CPU architecture you are running your code on&#41;. What is interesting is, that the results of the three function calls are not the same. </p>
<p>This is do to the fact that the numerics involved are are a bit tricky. In short, when adding floating point numbers you loose accuracy when adding a large number to a small number. This is exactly what is happening for our first example as we add all the numbers in one long sequence. </p>
<p>The built-in <code>sum</code> function as well as the <code>@simd</code> macro allow Julia to change the order of the operations. What it does is computing the result for the even and odd entries separately and therefore gaining a bit of accuracy.</p>
<p>If you are not sure if something is vectorized you can check out the LLVM code:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> InteractiveUtils

<span class=hljs-meta >@code_llvm</span> mysimdsum(a)</code></pre>
<pre><code class="plaintext hljs">;  @ none:1 within `mysimdsum`
define double @julia_mysimdsum_4948({}* nonnull align 16 dereferenceable(40) %0) #0 {
top:
;  @ none:4 within `mysimdsum`
; ┌ @ simdloop.jl:69 within `macro expansion`
; │┌ @ abstractarray.jl:279 within `eachindex`
; ││┌ @ abstractarray.jl:116 within `axes1`
; │││┌ @ abstractarray.jl:95 within `axes`
; ││││┌ @ array.jl:151 within `size`
       %1 = bitcast {}* %0 to {}**
       %2 = getelementptr inbounds {}*, {}** %1, i64 3
       %3 = bitcast {}** %2 to i64*
       %4 = load i64, i64* %3, align 8
; └└└└└
; ┌ @ simdloop.jl:72 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %.not = icmp eq i64 %4, 0
; │└
   br i1 %.not, label %L30, label %L13.lr.ph

L13.lr.ph:                                        ; preds = %top
   %5 = bitcast {}* %0 to double**
   %6 = load double*, double** %5, align 8
; └
; ┌ @ simdloop.jl:75 within `macro expansion`
   %min.iters.check = icmp ult i64 %4, 16
   br i1 %min.iters.check, label %L13, label %vector.ph

vector.ph:                                        ; preds = %L13.lr.ph
   %n.vec = and i64 %4, 9223372036854775792
   br label %vector.body

vector.body:                                      ; preds = %vector.body, %vector.ph
; └
; ┌ @ simdloop.jl:78 within `macro expansion`
; │┌ @ int.jl:87 within `+`
    %index = phi i64 [ 0, %vector.ph ], [ %index.next, %vector.body ]
    %vec.phi = phi &lt;4 x double&gt; [ zeroinitializer, %vector.ph ], [ %15, %vector.body ]
    %vec.phi9 = phi &lt;4 x double&gt; [ zeroinitializer, %vector.ph ], [ %16, %vector.body ]
    %vec.phi10 = phi &lt;4 x double&gt; [ zeroinitializer, %vector.ph ], [ %17, %vector.body ]
    %vec.phi11 = phi &lt;4 x double&gt; [ zeroinitializer, %vector.ph ], [ %18, %vector.body ]
; └└
; ┌ @ simdloop.jl:77 within `macro expansion` @ none:5
; │┌ @ array.jl:861 within `getindex`
    %7 = getelementptr inbounds double, double* %6, i64 %index
    %8 = bitcast double* %7 to &lt;4 x double&gt;*
    %wide.load = load &lt;4 x double&gt;, &lt;4 x double&gt;* %8, align 8
    %9 = getelementptr inbounds double, double* %7, i64 4
    %10 = bitcast double* %9 to &lt;4 x double&gt;*
    %wide.load12 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %10, align 8
    %11 = getelementptr inbounds double, double* %7, i64 8
    %12 = bitcast double* %11 to &lt;4 x double&gt;*
    %wide.load13 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %12, align 8
    %13 = getelementptr inbounds double, double* %7, i64 12
    %14 = bitcast double* %13 to &lt;4 x double&gt;*
    %wide.load14 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %14, align 8
; │└
; │┌ @ float.jl:399 within `+`
    %15 = fadd fast &lt;4 x double&gt; %vec.phi, %wide.load
    %16 = fadd fast &lt;4 x double&gt; %vec.phi9, %wide.load12
    %17 = fadd fast &lt;4 x double&gt; %vec.phi10, %wide.load13
    %18 = fadd fast &lt;4 x double&gt; %vec.phi11, %wide.load14
; └└
; ┌ @ simdloop.jl:78 within `macro expansion`
; │┌ @ int.jl:87 within `+`
    %index.next = add i64 %index, 16
    %19 = icmp eq i64 %index.next, %n.vec
    br i1 %19, label %middle.block, label %vector.body

middle.block:                                     ; preds = %vector.body
; └└
; ┌ @ simdloop.jl:75 within `macro expansion`
   %bin.rdx = fadd fast &lt;4 x double&gt; %16, %15
   %bin.rdx15 = fadd fast &lt;4 x double&gt; %17, %bin.rdx
   %bin.rdx16 = fadd fast &lt;4 x double&gt; %18, %bin.rdx15
   %20 = call fast double @llvm.vector.reduce.fadd.v4f64(double -0.000000e+00, &lt;4 x double&gt; %bin.rdx16)
   %cmp.n = icmp eq i64 %4, %n.vec
   br i1 %cmp.n, label %L30, label %L13

L13:                                              ; preds = %L13, %middle.block, %L13.lr.ph
   %value_phi18 = phi i64 [ %24, %L13 ], [ %n.vec, %middle.block ], [ 0, %L13.lr.ph ]
   %value_phi7 = phi double [ %23, %L13 ], [ %20, %middle.block ], [ 0.000000e+00, %L13.lr.ph ]
; └
; ┌ @ simdloop.jl:77 within `macro expansion` @ none:5
; │┌ @ array.jl:861 within `getindex`
    %21 = getelementptr inbounds double, double* %6, i64 %value_phi18
    %22 = load double, double* %21, align 8
; │└
; │┌ @ float.jl:399 within `+`
    %23 = fadd fast double %value_phi7, %22
; └└
; ┌ @ simdloop.jl:78 within `macro expansion`
; │┌ @ int.jl:87 within `+`
    %24 = add nuw nsw i64 %value_phi18, 1
; └└
; ┌ @ simdloop.jl:75 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %exitcond.not = icmp eq i64 %24, %4
; │└
   br i1 %exitcond.not, label %L30, label %L13

L30:                                              ; preds = %L13, %middle.block, %top
   %value_phi2 = phi double [ 0.000000e+00, %top ], [ %20, %middle.block ], [ %23, %L13 ]
; └
;  @ none:8 within `mysimdsum`
  ret double %value_phi2
}
</code></pre>
<pre><code class="julia hljs">a32 = rand(<span class=hljs-built_in >Float32</span>, length(a)*<span class=hljs-number >2</span>)
println(<span class=hljs-string >&quot;\nBuilt-in sum(FLOAT64) = &quot;</span>, sum(a))
<span class=hljs-meta >@btime</span> sum($a32)
println(<span class=hljs-string >&quot;\nBuild-in sum(FLOAT32) = &quot;</span>, sum(a32))
<span class=hljs-meta >@btime</span> sum($a32)</code></pre>
<pre><code class="plaintext hljs">
Built-in sum(FLOAT64) = 49930.269443853176
  15.200 μs (0 allocations: 0 bytes)

Build-in sum(FLOAT32) = 100020.984
  15.200 μs (0 allocations: 0 bytes)
100020.984f0</code></pre>
<h1 id=multiple_dispatch ><a href="#multiple_dispatch" class=header-anchor >Multiple dispatch? </a></h1>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> InteractiveUtils

<span class=hljs-meta >@code_typed</span> optimize=<span class=hljs-literal >false</span> mysum([<span class=hljs-number >1</span>, <span class=hljs-number >2</span>, <span class=hljs-number >3</span>])</code></pre>
<pre><code class="plaintext hljs">CodeInfo(
1 ─ %1  = eltype(a)::Core.Const(Int64)
│         (result = zero(%1))::Core.Const(0)
│   %3  = eachindex(a)::Base.OneTo{Int64}
│         (@_3 = Base.iterate(%3))::Union{Nothing, Tuple{Int64, Int64}}
│   %5  = (@_3 === nothing)::Bool
│   %6  = Base.not_int(%5)::Bool
└──       goto #4 if not %6
2 ┄ %8  = @_3::Tuple{Int64, Int64}
│         (i = Core.getfield(%8, 1))::Int64
│   %10 = Core.getfield(%8, 2)::Int64
│         $(Expr(:inbounds, true))::Any
│   %12 = result::Int64
│   %13 = Base.getindex(a, i)::Int64
│   %14 = (%12 + %13)::Int64
│         (result = %14)::Int64
│         (val = %14)::Int64
│         $(Expr(:inbounds, :pop))::Any
│         val::Int64
│         (@_3 = Base.iterate(%3, %10))::Union{Nothing, Tuple{Int64, Int64}}
│   %20 = (@_3 === nothing)::Bool
│   %21 = Base.not_int(%20)::Bool
└──       goto #4 if not %21
3 ─       goto #2
4 ┄       return result
) =&gt; Int64</code></pre>
<h1 id=concept_for_how_to_go_further ><a href="#concept_for_how_to_go_further" class=header-anchor >Concept for how to go further</a></h1>
<ul>
<li><p>introduce <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> example and let them program it</p>

<li><p>introduce multithreading and adapt the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> example</p>

<li><p>introduce multiple processes and adapt the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> example</p>

<li><p>introduce &quot;cluster&quot; and adapt <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> example</p>

<li><p>bring it to the GPU - show and tell, if the have gpus let them test</p>

<li><p>Repeat what we learned today</p>

<li><p>If on last day Q/A section</p>

</ul>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Gregor Ehrensperger, Peter Kandolf, Jonas Kusch. Last modified: June 27, 2022.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->
    
      



    
    
      


    
  


<script>
  (function(){  
    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.
  
    var pre = document.getElementsByTagName('pre');
  
    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.
  
    for (var i = 0; i < pre.length; i++) {
      var isLanguage = pre[i].children[0].className.indexOf('language-');
  
      if ( isLanguage === 0 ) {
        var button           = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';
  
            pre[i].appendChild(button);
      }
    };
  
    // Run Clipboard
  
    var copyCode = new Clipboard('.copy-button', {
      target: function(trigger) {
        return trigger.previousElementSibling;
      }
    });
  
    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.
  
    copyCode.on('success', function(event) {
      event.clearSelection();
      event.trigger.textContent = 'Copied';
      window.setTimeout(function() {
        event.trigger.textContent = 'Copy';
      }, 2000);
  
    });
  
    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.
  
    copyCode.on('error', function(event) {
      event.trigger.textContent = 'Press "Ctrl + C" to copy';
      window.setTimeout(function() {
        event.trigger.textContent = 'Copy';
      }, 5000);
    });
  
  })();
  </script>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solution");
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')
  console.log(myVar);
  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }
  }
</script>